# -*- coding: utf-8 -*-
"""
Created on Fri Sep 22 10:20:54 2017

@author: yash
"""

import sys
import os
import json
import pandas as pd

     
    
from watson_developer_cloud import DiscoveryV1

discovery = DiscoveryV1(
  username="849b1b65-8de2-4f94-80f9-a5cb9bf88fcb",
  password="taII2Sdea6rf",
  version="2017-09-01"
)

#Query passed to discovery service
qopts = {'query': '','filter':'company_name:apple'}
my_query = discovery.query('a8cec462-994b-4b34-a0cf-b85b4254a9ea', '539eedbd-22a6-4635-bb8c-defc9c57c1a4', qopts)
print(json.dumps(my_query, indent=2))

b = json.dumps(my_query, indent=2)
c = json.loads(b)

company_name = str(c['results'][0]['company_name'])
print(company_name)



#Generating JSONs after getting from NLC

df_3 = []
for i in range(0,100):
    df_3.append(i)
df_3 = pd.DataFrame(df_3)
df_3['Sentence'] =''
df_3['Label'] = ''
df_3['Score'] = ''    
#list2 = ['This Annual Report contains forward-looking statements within the meaning of Section 27A of the Securities Act of 1933, as amended, and Section 21E of the Securities Exchange Act of 1934, as amended.  Forward-looking statements are typically identified by use of terms such as “may,” “believe,” “expect,” “anticipate,” “intend,” “estimate,” “project,” “target,” “goal,” “plan,” “should,” “will,” “predict,” “potential,” “outlook,” “strategy,” and similar expressions that convey the uncertainty of future events or outcomes.  Such statements involve known and unknown risks, uncertainties, and other factors which may cause the actual results, performance, or achievements of Apple Hospitality REIT, Inc. (the “Company”) to be materially different from future results, performance or achievements expressed or implied by such forward-looking statements.', 'Company has elected to be treated as a REIT for federal income tax purposes.  The Company has wholly-owned taxable REIT subsidiaries, which lease all of the Company’s hotels from wholly-owned qualified REIT subsidiaries.  The Company’s common shares are listed on the New York Stock Exchange (“NYSE”) under the ticker symbol “APLE.”','During 2016, the Company’s Board of Directors authorized an extension of its share repurchase program to repurchase up to $475 million of its common shares, which program will end in July 2017, if not terminated earlier.  The program may be suspended or terminated at any time by the Company.  As part of the implementation of the program, the Company has utilized written trading plans, with the plans providing for share repurchases in open market transactions.  During 2016, the Company purchased approximately 0.4 million common shares under the program, at a weighted-average market purchase price of approximately $17.72 per common share for an aggregate purchase price of approximately $7.9 million. ','reduced business and leisure travel due to geo-political uncertainty, including terrorism, travel-related health concerns, including the widespread outbreak of infectious or contagious diseases in the U.S., inclement weather conditions, including natural disasters such as hurricanes and earthquakes, and airline strikes or disruptions','increases in operating costs, including increases in the cost of property insurance, utilities and real estate and personal property taxes, due to inflation and other factors that may not be offset by increased room rates;labor shortages and increases in the cost of labor due to low unemployment rates or to government regulations surrounding wage rates, health care coverage and other benefits;','In addition, many of the expenses associated with the Company’s business, including personnel costs, interest expense, ground leases, property taxes, insurance and utilities, are relatively fixed.  During a period of overall economic weakness, if the Company is unable to meaningfully decrease these costs as demand for its hotels decreases, the Company’s business operations and financial performance may be adversely affected.','.  The Company’s ratio of debt to total capitalization as of December 31, 2016 was 23%.  The Company may increase debt levels at any time to take advantage of investment opportunities, but would plan to reduce any significant increases as appropriate with the issuance of equity or property dispositions to maintain its flexible balance sheet and reduce risks to investors compared to those of highly leveraged companies.  The Company plans to maintain staggered maturities of its debt, utilize unsecured debt when available and fix the rate on the majority of its debt.  All of these strategies reduce shareholder risk related to the Company’s financing structure.','the Company had approximately $494.4 million in outstanding property level debt secured by 32 properties, with maturity dates ranging from February 2017 to December 2026 and stated interest rates ranging from 3.55% to 6.25%.']

#list2_apple = ['This Annual Report contains forward-looking statements within the meaning of Section 27A of the Securities Act of 1933, as amended, and Section 21E of the Securities Exchange Act of 1934, as amended.  Forward-looking statements are typically identified by use of terms such as “may,” “believe,” “expect,” “anticipate,” “intend,” “estimate,” “project,” “target,” “goal,” “plan,” “should,” “will,” “predict,” “potential,” “outlook,” “strategy,” and similar expressions that convey the uncertainty of future events or outcomes.  Such statements involve known and unknown risks, uncertainties, and other factors which may cause the actual results, performance, or achievements of Apple Hospitality REIT, Inc. (the “Company”) to be materially different from future results, performance or achievements expressed or implied by such forward-looking statements.', 'Company has elected to be treated as a REIT for federal income tax purposes.  The Company has wholly-owned taxable REIT subsidiaries, which lease all of the Company’s hotels from wholly-owned qualified REIT subsidiaries.  The Company’s common shares are listed on the New York Stock Exchange (“NYSE”) under the ticker symbol “APLE.”','During 2016, the Company’s Board of Directors authorized an extension of its share repurchase program to repurchase up to $475 million of its common shares, which program will end in July 2017, if not terminated earlier.  The program may be suspended or terminated at any time by the Company.  As part of the implementation of the program, the Company has utilized written trading plans, with the plans providing for share repurchases in open market transactions.  During 2016, the Company purchased approximately 0.4 million common shares under the program, at a weighted-average market purchase price of approximately $17.72 per common share for an aggregate purchase price of approximately $7.9 million. ','reduced business and leisure travel due to geo-political uncertainty, including terrorism, travel-related health concerns, including the widespread outbreak of infectious or contagious diseases in the U.S., inclement weather conditions, including natural disasters such as hurricanes and earthquakes, and airline strikes or disruptions','increases in operating costs, including increases in the cost of property insurance, utilities and real estate and personal property taxes, due to inflation and other factors that may not be offset by increased room rates;labor shortages and increases in the cost of labor due to low unemployment rates or to government regulations surrounding wage rates, health care coverage and other benefits;','In addition, many of the expenses associated with the Company’s business, including personnel costs, interest expense, ground leases, property taxes, insurance and utilities, are relatively fixed.  During a period of overall economic weakness, if the Company is unable to meaningfully decrease these costs as demand for its hotels decreases, the Company’s business operations and financial performance may be adversely affected.','The Company’s ratio of debt to total capitalization as of December 31, 2016 was 23%.  The Company may increase debt levels at any time to take advantage of investment opportunities, but would plan to reduce any significant increases as appropriate with the issuance of equity or property dispositions to maintain its flexible balance sheet and reduce risks to investors compared to those of highly leveraged companies.  The Company plans to maintain staggered maturities of its debt, utilize unsecured debt when available and fix the rate on the majority of its debt.  All of these strategies reduce shareholder risk related to the Company’s financing structure.','the Company had approximately $494.4 million in outstanding property level debt secured by 32 properties, with maturity dates ranging from February 2017 to December 2026 and stated interest rates ranging from 3.55% to 6.25%.','The success of the Company’s hotels depends largely on the hotel operators’ ability to adapt to dominant trends in the hotel industry, both nationally and in individual local markets, as well as greater competitive pressures, dependence on consumer spending patterns, changing demographics, the introduction of new concepts and products, availability of labor, price levels and general economic conditions','The core principle of the new standard is that revenue should be recognized to depict the transfer of promised goods or services to customers in an amount that reflects the consideration to which the entity expects to be entitled in exchange for those goods or services.','Apple Ten no longer pays the various fees that were paid to the Company under the subcontract agreement and A10A no longer subcontracts its advisory services to the Company.','The acquisitions have been in broadly diversified markets across the United States to limit dependence on any one geographic area or demand generator','The Company’s failure to identify and complete accretive acquisitions may adversely affect the profitability of the Company.','changes in marketing and distribution for the industry including the cost and the ability of third-party internet and other travel intermediaries to attract and retain customers ']
#list2_deutshe_post = ['the 14 day ADX for Deutsche Post AG is sitting at 25.17. an ADX value from 0 to 25 would indicate an absent or weak trend A value of 25 to 50 would support a strong trend','Deutsche Post AG currently has a 14 day Commodity Channel Index (CCI) of 128.11 Active investors may choose to use this technical indicator as a stock evaluation tool ','Used as a coincident indicator, the CCI reading above +100 would reflect strong price action which may signal an uptrend','Fortunately for investors we have identified a strong candidate which may be an impressive value Deutsche Post AG DPSGY ','Deutsche Post DHL has agreed to sell its British outsourcing subsidiary Williams Lea Tag to private equity group Advent International to focus on its core logistics service business','Deutsche Post eyes record Christmas parcel business in Germany','Deutsche Post DHL is benefiting from the rise in online shopping delivering packages ordered','The Post eCommerce Parcel segment handles both domestic and international mail and provides dialogue marketing nationwide press distribution services and all electronic services associated with mail delivery','Deutsche Post DHL Group Benefiting From Air Cargo Growth In 2017','DHL Groups Global Forwarding Freight segment has been one of the stronger operating revenue contributors for 2017','The Post – eCommerce – Parcel segment handles both domestic and international mail and provides dialogue marketing, nationwide press distribution services and all electronic services associated with mail delivery.','Participating in motor racing has enabled us to make our brand known internationally and it is fully trusted by our clients in Europe and worldwide. This is a good time to stop.','Value investing is always a very popular strategy, and for good reason. After all, who doesnt want to find stocks that have low PEs, solid outlooks, and decent dividends','Although it was originally intended for commodity traders to help identify the start and finish of market trends, it is frequently used to analyze stocks as well.','Moving averages can help spot trends and price reversals. They may also be used to help find support or resistance levels. Moving averages are considered to be lagging indicators meaning that they confirm trends.']
#list2_google = ['Competing successfully depends heavily on our ability to deliver innovative products and technologies to the marketplace rapidly and for Google provide products and services that make our search results and ads relevant and useful for our users.','As our businesses evolve the competitive pressure to innovate will encompass a wider range of products and services including products and services that may be outside of our historical core business.','We have many competitors in different industries including general purpose search engines and information services vertical search engines and ecommerce websites social networks providers of online products and services other forms of advertising and online advertising platforms and networks other operating systems and wireless mobile device companies. ','Emerging startups may be able to innovate and provide products and services faster than we can or may foresee the consumer need for products and services before us.','Our competitors are constantly developing innovations in search online advertising wireless mobile devices operating systems and many other webbased products and services. ','we may make acquisitions increase our capital expenditures or license products and technologies complementary to our business and may need to raise additional capital through future debt or equity financing to provide for greater flexibility to fund these activities.','We have a debt financing program of up to $3 billion through the issuance of commercial paper. ','Antitrust lawyer Mark Patterson told Ars Technica that if Google could show that they chose not to allow Gab into the Play Store because of possible reputational damage from that strong association with hate groups the antitrust claim would have little chance of success.','Cash equivalents and marketable securities are comprised of time deposits money market and other funds including cash collateral received related to our securities lending program fixedincome bond funds highly liquid debt instruments of the U.S. government and its agencies debt instruments issued by foreign governments debt instruments issued by municipalities in the U.S','Our international operations are significant to our revenues and net income and we plan to continue to grow internationally. ','From time to time we may hold marketable equity securities obtained through acquisitions or strategic investments in private companies that subsequently go public.','Further if we fail to maintain and enhance equity in the Google brand our business operating results and financial condition may be materially and adversely affected.','Our current and potential domestic and international competitors range from large and established companies to emerging startups.','As technology continues to develop our competitors may be able to offer user experiences that are or that are seen to be substantially similar to or better than ours.','If our competitors are more successful than we are in developing compelling products or in attracting and retaining users advertisers and content providers our revenues and operating results could be adversely affected.','In addition compliance with complex foreign and U.S. laws and regulations that apply to our international operations increases our cost of doing business','Maintaining and enhancing our brand will depend largely on our ability to remain a technology leader and continue to provide highquality innovative products and services that are truly useful and play a meaningful role in people’s everyday lives.','Violations of these laws and regulations could result in fines and penalties criminal sanctions against us our officers or our employees prohibitions on the conduct of our business and on our ability to offer our products and services in one or more countries and could also materially affect our brand','Established companies have longer operating histories and more established relationships with customers and users and they can use their experiences and resources in ways that could affect our competitive position','unidentified issues not discovered in our due diligence of such strategies and offerings that could cause us to fail to realize the anticipated benefits of such investments and incur unanticipated liabilities','Established companies can use their experiences and resources in ways that could affect our competitive position including by making acquisitions continuing to invest heavily in research and development','The research and development of new technologically advanced products is also a complex and uncertain process requiring high levels of innovation and investment','a graphics process maker with a leadership position in these spaces defines each of them  and what the companys potential is in these businesses.','regulatory disruption or at least regulatory scrutiny for the foreseeable future and such hurdles could limit the company growth.']
list2_dailmer=['The IRS has issued regulations stating that the FATCA withholding tax will not be imposed with respect to gross proceeds from a disposition of equity or debt instruments of U.S. issuers with respect to payments made prior to January 1, 2019.','the IRS successfully asserted that one or more of the Notes did not represent debt for federal income tax purposes','Income received on the investment of funds on deposit in the Reserve Fund will be part of Available Funds.','A publicly traded partnership is taxed in the same manner as a corporation unless at least 90% of its gross income consists of specified types of “qualifying income”','No effort will be made to monitor the Notes, and they may very well be so treated if considered equity','If the Notes were treated as equity interests in a partnership, the Issuer would be treated as a “publicly traded partnership”','Daimler AG is working on a corporate holding structure that could see Mercedes-Benz Financial Services broken out into a separate entity before the company’s annual general meeting on April 5, 2019, according to a new interview with chief executive Dieter Zetsche and chief financial officer Bodo Uebber.','Separating the divisions legally could allow for a partial listing, and is a way to raise funds to invest in new services such as autonomous and electric cars.','On the other hand, cash provided by operating activities was reduced by higher utilization of provisions and by the lower operating profit in 2016','Our goal is to offer our customers fascinating products and customized solutions for needs-oriented, safe and sustainable mobility','In order to implement our growth strategy with new products, innovative technologies and modern production capacities, we increased the expenditure for securing our future in 2016','On the one hand, this is about the ever increasing connectivity of our products: with customer-oriented digital services, new business models and digital communication with customers – from the initial contact and through the entire customer relationship','In financial year 2016, no remuneration was paid for services provided personally beyond the aforementioned board and committee activities, in particular for advisory or agency services','the Legal departement and Group Compliance, and is chaired by the Board of Management Member for Finance & Controlling / Daimler Financial Services.','The protection of our products and services from danger caused by hacking and cybercrime is developed in line with the threat situation.','Against this backdrop, we plan to increase our unit sales once again. Daimler Financial Services also aims to achieve further growth.','The smart brand has always played a pioneering role in the automotive industry in terms of mobility services and customization options, and continually redefines urban mobility.','We also offer our customers tailored transport and mobility services that improve efficiency and reflect the growing trend toward a sharing economy.','Daimler Financial Services is also aiming to achieve the highest possible degree of customer satisfaction and greater customer loyalty under the motto “Engaging customers for life.”','Most of our outlay for research and development will be used for new products, innovative drive-system and safety technolo-gies, vehicle connectivity systems and the further development of autonomous-driving technologies.','In order to achieve our ambitious goals, we cooperate very closely also with research and development units from the sup-plier industry. ','The established human resources instruments take such personnel risks into consideration, while contributing toward the recruitment and retention of staff with high potential and expertise and ensuring transparency with regard to the resources of the Daimler Group']


list2 = list2_dailmer
from watson_developer_cloud import NaturalLanguageClassifierV1

#Classifier for Category
natural_language_classifier = NaturalLanguageClassifierV1(
  username='ebe8fc2e-e573-4748-8043-070d6045e3c9',
  password='bmoUJcVQqSPp')
  
#Classifier for Score
natural_language_classifier1 = NaturalLanguageClassifierV1(
  username='0cf14d58-17ca-4b1a-beed-0ac56d337b66',
  password='ZUe5kPY2adJU')    

for i in range(len(list2)):
    classes = natural_language_classifier.classify('6a2a04x217-nlc-24088', str(list2[i]))
    data = json.dumps(classes, indent=2)
    classes1 = natural_language_classifier1.classify('6a2a04x217-nlc-28145', str(list2[i]))
    data1 = json.dumps(classes1, indent=2)
    nlc_data = json.loads(data)
    top_class = nlc_data["top_class"]
    print(top_class)
    print(nlc_data)
    
    if (nlc_data["top_class"] == "leadership" or nlc_data["top_class"] == "strategy" or  nlc_data["top_class"] == "research and development" or nlc_data["top_class"] == "transparency"):
        category = "Management Risk"
    if (nlc_data["top_class"] == "products" or nlc_data["top_class"] == "services" or  nlc_data["top_class"] == "brand" or nlc_data["top_class"] == "marketing" or nlc_data["top_class"] == "acquisition" or nlc_data["top_class"] == "merger" or nlc_data["top_class"] == "customer goodwill" or nlc_data["top_class"] == "rating" or nlc_data["top_class"] == "insolvency" or nlc_data["top_class"] == "bankruptcy"):
        category = "Business Risk"    
    if (nlc_data["top_class"] == "operating environment" or nlc_data["top_class"] == "industry growth" or  nlc_data["top_class"] == "competitors" or nlc_data["top_class"] == "regulation" or nlc_data["top_class"] == "trends" or nlc_data["top_class"] == "market size" or nlc_data["top_class"] == "industry segements"):
        category = "Industry Risk"   
    if (nlc_data["top_class"] == "debt" or nlc_data["top_class"] == "financial profile" or  nlc_data["top_class"] == "strong results" or nlc_data["top_class"] == "financial benchmarking" or nlc_data["top_class"] == "income" or nlc_data["top_class"] == "equity" or nlc_data["top_class"] == "profit"):
        category = "Financial Risk" 
        
    nlc_data1 = json.loads(data1)
    score = nlc_data1["top_class"]
    if(score == "positive"):
        score = "1"
    if(score == "negative"):
        score = "-1"
    if(score == "neutral"):
        score = "0"    
    
    #new = []
    
    classification = {"sentence":str(list2[i]),"label":category}
    df_3['Label'][i] = list(classification.values())[0]
    df_3['Sentence'][i] = list(classification.values())[1]
#    df['Topic'][i] = str(list2[i])
    score_individual = {"sentence":str(list2[i]),"label":category,"score":score}
    print(nlc_data1)
    print(score_individual)
#    df_3['Sentence'][i] = list(score_individual.values())[2]
#    df_3['Label'][i] = list(score_individual.values())[1]
    df_3['Score'][i] = list(score_individual.values())[0]

df_managerisk = df_3[(df_3['Label'] == "Management Risk")]   
df_financial =   df_3[(df_3['Label'] == "Financial Risk")]
df_industryr = df_3[(df_3['Label'] == "Industry Risk")]
df_businessRisk = df_3[(df_3['Label'] == "Business Risk")]


#Insert final object into cloudant
from cloudant.client import Cloudant
client = Cloudant("05c45fdb-3859-417d-8d4e-6f3c176dfeec-bluemix","5e856fd817b32fe4948f66f7b763de6750075be56d5dc8bd32cfa38e992b48bc", url='https://05c45fdb-3859-417d-8d4e-6f3c176dfeec-bluemix:5e856fd817b32fe4948f66f7b763de6750075be56d5dc8bd32cfa38e992b48bc@05c45fdb-3859-417d-8d4e-6f3c176dfeec-bluemix.cloudant.com',connect=True,auto_renew=True)

# Create document content data
#data = { "company name":"IBM", "rating information": { "estimated credit rating":"AA", "financial risk info": { "rating":"AA", "evidence": [ "evidence 1", "evidence 2", "evidence 3" ] }, "industrial risk info": { "rating":"AA", "evidence": [ "evidence 1", "evidence 2", "evidence 3" ] }, "management risk info": { "rating":"AA", "evidence": [ "evidence 1", "evidence 2", "evidence 3" ] }, "____ risk info": { "rating":"AA", "evidence": [ "evidence 1", "evidence 2", "evidence 3" ] } } }
data1 = {"company_name":"Daimler","rating information": { "estimated credit rating":"AA", "financial risk info": { "rating":"AA", "evidence": [ df_financial.iloc[0]['Sentence'], df_financial.iloc[1]['Sentence'], df_financial.iloc[2]['Sentence'] ] }, "industrial risk info": { "rating":"AA", "evidence": [ df_industryr.iloc[0]['Sentence']] }, "management risk info": { "rating":"AA", "evidence": [ df_managerisk.iloc[0]['Sentence'],df_managerisk.iloc[1]['Sentence'],df_managerisk.iloc[2]['Sentence']] }, "Business Risk info": { "rating":"AA", "evidence": [ df_businessRisk.iloc[0]['Sentence'],  df_businessRisk.iloc[1]['Sentence'],  df_businessRisk.iloc[2]['Sentence'] ] } }}
    
my_database = client['test']

# Create a document using the Database API
my_document = my_database.create_document(data1)

# Check that the document exists in the database
if my_document.exists():
    print ('SUCCESS!!') 